<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>알페로 상품 크롤링</title>
	
	<link rel="stylesheet" href="../css/index.css" />
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
	<form name="frm" id="frm" enctype="multipart/form-data" method="post" onsubmit="return false;" class="uk-form">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
	        <tbody>
	            <tr>
	                <td height="41" align="left" style="font-weight:bold; font-size:15px;">
	                    <img src="" > 쇼핑몰 상품 정보 크롤링
	                </td>
	            </tr>
	            <tr>
	                <td height="1" bgcolor="e8e8e8"></td>
	            </tr>
	        </tbody>
	    </table>
	    
	    <br>
	    
	    <div id="listButtonLayer">
	        &nbsp;<font color="#FF0000"><b> * 상품 등록작업시 먼저 5개정도 상품등록 후 수집 (가격, 품번, 사진등)내역 확인 부탁드립니다.  <br>&nbsp; *  각 브랜드별 공통이미지나 공통 제거 문구 미리알려 주시면 데이터 수집할때 제외 처리해 드리겠습니다. <br>&nbsp; *  등록 후 삭제하기 힘듭니다. </b></font> <br><br> 
	        검색결과 : <span id="total_cnt">0</span>건
	
	        <!--※ 등록일자 기준 내림차순 정렬됩니다.-->
	    </div>
	    
	    <div id="listSearchConditionLayer">
	        <fieldset>
	            <legend>검색조건</legend>
	            <div class="row">
	                <span class="item">
	                    <span class="title">쇼핑몰</span>
	                    <select name="tmp_shop_id" id="tmp_shop_id" readonly="" class="select2 select2-hidden-accessible" width="200" data-select2-id="select2-data-tmp_shop_id" tabindex="-1" aria-hidden="true">
	                        <option value="100101" selected="" data-select2-id="select2-data-2-81wg">프롬비아이</option>
	                        <option value="100102">아떼스타</option>
	                        <option value="100103">대상유통</option>
	                    </select>
	                    <span class="select2 select2-container select2-container--default" dir="ltr" data-select2-id="select2-data-1-b23x" style="width: 200px;">
	                        <span class="selection">
	                            <span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-disabled="false" aria-labelledby="select2-tmp_shop_id-container" aria-controls="select2-tmp_shop_id-container">
	                                <span class="select2-selection__rendered" id="select2-tmp_shop_id-container" role="textbox" aria-readonly="true" title="프롬비아이">프롬비아이</span>
	                                <span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>
	                            </span>
	                        </span>
	                        <span class="dropdown-wrapper" aria-hidden="true"></span>
	                    </span>
	                </span>
	                <span class="item">
	                    <span class="title">키워드 또는 URL</span>
	                    <input type="text" id="tmp_kwd" name="tmp_kwd" value="" required="srch" label="키워드" class="textfield w6" autocomplete="off">
	                    <a href="#list" class="btnSrch"> <input type="button" class="btnSrchKwd" value="검색" autocomplete="off" onClick="searchCrawling()"></a>
	                </span>
	
	
	                <span class="item">
	                    <span class="title">로그인 필요 여부</span>
	                    로그인 필요 / 불필요
	                </span>
	                <span class="item">
	                    <span class="title">상품상세 삭제구문관리</span>
	                    0건
	                    <input type="button" class="btnOpenConDel" value="구문관리" autocomplete="off">
	                    <input type="button" class="btnOpenXtrPdList" value="등록상품목록(등록:2201)" autocomplete="off">
	                    <input type="button" class="btnOpenXtrPdallList" value="브랜드등록현황" autocomplete="off">
	                </span>
	            </div>
	
	            <div class="row">
	                <span class="item">
	                    <span class="title">URL</span>
	                    <input type="text" id="cllUrl" value="https://www.nike.com" class="textfield" size="130" readonly="" autocomplete="off">
	                    <input type="button" class="btnGoUrl" value="새창으로 바로가기" autocomplete="off">
	                </span>
	            </div>
	
	            <div class="row">
	                <textarea rows="10" cols="90" name="exinfo">상품 정보 조회시 유의 사항
	                </textarea>
	            </div>
	
	        </fieldset>
	    </div>
	    
	    <div id="listSearchConditionLayer">
	        <fieldset>
	            <legend>상품 정보 다운로드</legend>
	            <div class="row">
	                <span class="item">
	                    <span class="title">카테고리</span>
	                    <select name="shop_ctg1" id="shop_ctg1" required="reg" label="1차카테고리"><option value="">::1차카테고리 선택::</option><option value="0a">아웃도어</option><option value="10">스포츠</option><option value="20">캐주얼</option><option value="30">골프</option><option value="40">명품</option><option value="50">키즈</option><option value="80">완구</option><option value="90">기타 (속옷/잡화)</option><option value="a0">침구</option><option value="b0">반려동물용품</option></select>
	                    <select name="shop_ctg2" id="shop_ctg2" required="reg" label="2차카테고리"><option value="">::2차카테고리 선택::</option></select>
	                    <select name="shop_ctg3" id="shop_ctg3" required="reg" label="3차카테고리"><option value="">::3차카테고리 선택::</option></select>
	                </span>
	                <span class="item">
	                    <span class="title">품번병합여부</span>
	                    <select name="mrg_yn" id="mrg_yn">
	                        <option value="y">Y</option>
	                        <option value="n" selected="">N</option>
	                    </select>
	                </span>
	                <button !class="ui-button ui-widget ui-corner-all" id="btnReg">등록</button>
	                <button !class="ui-button ui-widget ui-corner-all" id="btnDel">삭제</button>
	                &nbsp;(<font style=" font-size:13px; color:#ff0000; font-weight:bold;">대기상품만 삭제 가능</font>) 
	                
	            </div>
	            <div>
					<span>
						<input type="checkbox" id="chk_img_hidden" onClick="hideImage();">이미지 비노출
					</span>
				</div>
	        </fieldset>
	    </div>
	    
	    <div id="listLayer">
	        <table border="0" width="100%" cellspacing="0" cellpadding="0">
	            <tbody>
	                <tr>
	                    <th class="th_checkBox th_left center"><input type="checkbox" id="ck_all" autocomplete="off"></th>
	                    <th class="th_image th_middle">이미지</th>
	                    <th class="th_gname th_middle">상품명</th>
	                    <th class="th_priceRec th_middle">권장판매가</th>
	                    <th class="th_priceOri th_middle">도매가</th>
	                    <th class="th_option th_middle">옵션</th>
	                    <!-- <th class="th_middle">상세이미지</th>  -->
	                </tr>
	                <!--
	                <tr>
	                 
	                    <td class="td_left center"><input type="checkbox" class="ck" name="ck[]" value="NT7UP44B" msg="항목을 선택하세요." autocomplete="off">
	                        <input type="hidden" name="url_NT7UP44B" value="https://www.thenorthfacekorea.co.kr/product/NT7UP44B" autocomplete="off"> 
	                    </td>
	                    <td class="td_middle center"><img src="/genie4you/upld/pd/110212/NT7UP44B.jpg" width="100" height="100"></td>
	                    <td class="td_middle">CIRRUS S/S R/TEE</td>
	                    <td class="td_middle center"></td>
	                    <td class="td_middle center"></td>
	                    <td class="td_middle center"></td>
	                    <td class="td_middle center"></td>
	                    <td class="td_middle center"></td>
	                </tr>
	                -->
	               
	            </tbody>
	        </table>
	    </div>
	</form>
</body>

<script type="text/javascript">
	$(document).ready(function(){
		searchCrawling();
	})
	.ajaxStart(function(){
		LoadingWithMask();
	})
	.ajaxStop(function(){
		closeLoadingWithMask();
	});
	
	function LoadingWithMask() {
	    var maskHeight = $(document).height();
	    var maskWidth  = window.document.body.clientWidth;
	     
	    var loadingArea = "<div id='loadingArea' style='position:absolute; z-index:9000; background-color:#000000; display:none; left:0; top:0;'></div>";
	    var loadingImg = '';
	 
	    loadingImg += "<div id='loadingImg'>";
	    loadingImg += " <img src='img/loadingBar.gif' style='position: absolute; display: block; margin: 0px auto;'/>";
	    loadingImg += "</div>"; 
	 
	    $('body')
	        .append(loadingArea)
	        .append(loadingImg);
	 
	    $('#loadingArea').css({
	            'width' : maskWidth,
	            'height': maskHeight,
	            'opacity' : '0.3'
	    }); 
	  
	    //마스크 표시
	    $('#loadingArea').show();
	  
	    //로딩중 이미지 표시
	    $('#loadingImg').show();
	}
	 
	function closeLoadingWithMask() {
	    $('#loadingArea, #loadingImg').hide();
	    $('#loadingArea, #loadingImg').empty();  
	}
	
	function wrapWindowByMask(){
		var maskHeight = $(document).height();  
		var maskWidth = $(window).width();  
		
		$('#loadingArea').css({'width':maskWidth,'height':maskHeight});  
		
		$('#loadingArea').fadeTo("slow",0.6);    
	}
	
	/*
		URL기준 크롤링 버튼
	*/
	function searchCrawling(){
		var url = "https://fromvi.com/product/detail.html?product_no=1221";
		$.ajax({
			url:"/alpero",
			type:"POST",
			data:url,
			contentType: "application/json; charset=utf-8",
			success: function onData(data){
				console.log(data);
				drawingTable(data);
			},
			error: function onError(error){
				
			}
		}) 
	}
	
	function drawingTable(data){
		//$("#listLayer tbody").empty();
		/*
		if(data == null){
			var innerHtml = "";
			innerHtml += '<tr>';
            innerHtml += '<td colspan="20" class="no_data_row">조회된 자료가 없습니다.</td>';
        	innerHtml += '</tr>';
        	
        	return;
        	$("#listLayer tbody").append(innerHtml);
		}
		*/
		for(var i = 0; i<data.length; i++){
			var innerHtml = "";
			innerHtml += '<tr>';
			innerHtml += '	<td class="td_left center"><input type="checkbox" class="ck" name="ck[]" value="" msg="항목을 선택하세요." autocomplete="off">';
			innerHtml += '		<input type="hidden" name="" value="" autocomplete="off">';
			innerHtml += '	</td>';
			innerHtml += '	<td  class="td_image td_middle center"><img src="'+data[i].imgThumbLink+'"></td>';
			innerHtml += '	<td  class="td_gname td_middle center">'+data[i].title+'</td>';
			innerHtml += '	<td  class="td_priceRec td_middle center">'+data[i].price1+'</td>';
			innerHtml += '	<td  class="td_priceOri td_middle center">'+data[i].price2+'</td>';
			innerHtml += '	<td  class="td_option td_middle ">'+data[i].sele+'</td>';
			innerHtml += '</tr>';
			
			$("#listLayer tbody").append(innerHtml);
		}
		
		innerHtmlCss();
		
		hideImage();
	}
	
	/*innerHtml css 적용*/
	function innerHtmlCss(){
		$(".td_image").css({
			"padding":"0"
		});
		$(".td_image img").css({
			"max-width":"80px",
			"margin":"3px 0 3px 0"
		});
		$(".td_gname").css({
			"width":"180px",
			"min-width" : "180px",
			"max-width" : "180px",
			"line-height" : "18px",
			"overflow" : "visible",
			"text-overflow" : "ellipsis",
			"white-space" : "normal"
		});
		$(".td_option").css({
			"padding":"10px 0"
		});
	}	
	
	/*이미지 노출 여부 버튼 이벤트*/
	function hideImage(){
		var chk = $("#chk_img_hidden").is(":checked");
		
		if(chk){
			$("#listLayer .th_image").css("display","none");
			$("#listLayer .td_image").css("display","none");
		}else{
			$("#listLayer .th_image").css("display","");
			$("#listLayer .td_image").css("display","");
		}
	}
</script>
</html>